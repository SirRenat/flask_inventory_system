{% extends 'base.html' %}

{% block title %}–°–æ–æ–±—â–µ–Ω–∏—è ‚Äî –ê–¥–º–∏–Ω–∫–∞{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="admin-header">
        <h1 class="page-title">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
        <p class="admin-subtitle">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∏ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏</p>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="admin-tabs mb-4">
        <div class="tabs">
            <a href="{{ url_for('admin_bp.admin_categories') }}" class="tab-btn">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
            <a href="{{ url_for('admin_bp.admin_users') }}" class="tab-btn">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            <a href="{{ url_for('admin_bp.admin_contact_requests') }}" class="tab-btn active">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</a>
        </div>
    </div>

    <div class="admin-section mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">–°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π</h5>
            <span class="badge bg-secondary">{{ requests|length if requests else 0 }} –≤—Å–µ–≥–æ</span>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π -->
    {% if requests %}
    <div class="table-responsive" style="max-width: 100%; overflow-x: auto;">
        <table class="table table-hover align-middle" style="width: 100%; table-layout: fixed; font-size: 13px;">
            <thead class="table-light">
                <tr>
                    <th style="width: 5%;">ID</th>
                    <th style="width: 12%;">–î–∞—Ç–∞</th>
                    <th style="width: 15%;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                    <th style="width: 20%;">–ö–æ–Ω—Ç–∞–∫—Ç</th>
                    <th style="width: 33%;">–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    <th style="width: 8%;">–°—Ç–∞—Ç—É—Å</th>
                    <th style="width: 7%;">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requests %}
                <tr>
                    <td style="padding: 8px 10px;">{{ req.id }}</td>
                    <td style="padding: 8px 10px;">{{ req.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td style="padding: 8px 10px;">
                        <span class="badge bg-secondary">{{ req.category }}</span>
                    </td>
                    <td style="word-break: break-word; padding: 8px 10px;">{{ req.contact_info }}</td>
                    <td style="word-break: break-word; padding: 8px 10px;">
                        <div style="max-height: 80px; overflow-y: auto;">
                            {{ req.message }}
                        </div>
                    </td>
                    <td style="padding: 8px 10px;">
                        {% if req.status == 'new' %}
                        <span class="badge bg-danger">–ù–æ–≤–æ–µ</span>
                        {% elif req.status == 'read' %}
                        <span class="badge bg-warning text-dark">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</span>
                        {% else %}
                        <span class="badge bg-success">–†–µ—à–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                    <td style="padding: 8px 10px;">
                        <form action="{{ url_for('admin_bp.toggle_request_status', request_id=req.id) }}" method="POST"
                            class="d-inline">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-outline-primary"
                                title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–ù–æ–≤–æ–µ -> –ü—Ä–æ—á–∏—Ç–∞–Ω–æ -> –†–µ—à–µ–Ω–æ)">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="text-center py-5">
        <div class="fs-1 mb-3">üì≠</div>
        <h4>–ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</h4>
        <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
    </div>
    {% endif %}
</div>

<style>
    /* === –ï–î–ò–ù–´–ô –î–ò–ó–ê–ô–ù –° admin_categories.html === */

    .admin-header {
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        color: white;
        padding: 32px;
        border-radius: 12px;
        margin-bottom: 24px;
        text-align: center;
    }

    .admin-header .page-title {
        font-size: 32px;
        margin-bottom: 8px;
    }

    .admin-tabs {
        background: var(--background);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        margin-bottom: 24px;
        overflow: hidden;
    }

    .tabs {
        display: flex;
        gap: 2px;
        background: var(--background-secondary);
        padding: 4px;
    }

    .tab-btn {
        flex: 1;
        padding: 14px 20px;
        background: transparent;
        border: none;
        border-radius: calc(var(--radius) - 2px);
        font-weight: 500;
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 14px;
    }

    .tab-btn:hover {
        background: var(--background);
        color: var(--text-primary);
    }

    .tab-btn.active {
        background: var(--background);
        color: var(--avito-blue);
        box-shadow: var(--shadow-light);
    }

    .admin-section {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #e0e0e0;
    }

    .table-responsive {
        max-width: 100%;
        overflow-x: auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .table {
        margin-bottom: 0;
        width: 100%;
        table-layout: fixed;
        font-size: 13px;
    }

    .table th,
    .table td {
        padding: 8px 10px;
        vertical-align: middle;
        word-break: break-word;
        font-size: 13px;
    }
</style>
{% endblock %}