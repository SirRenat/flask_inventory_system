<div class="list-responsive-wrapper">
    <div class="products-list-view">
        {% for product in products %}
        <div class="list-product-card"
            onclick="location.href='{{ url_for('main.product_detail', product_id=product.id) }}'">
            <div class="list-product-image">
                <!-- Значок избранного -->
                {% if current_user.is_authenticated and product in current_user.favorited_products %}
                <div class="favorite-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="red" stroke="red" stroke-width="1.5">
                        <path
                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                    </svg>
                </div>
                {% endif %}
                {% set image_list = product.images | deserialize_images %}
                {% if image_list | length > 0 %}
                <img src="{{ url_for('main.serve_uploaded_file', filename=image_list[0]) }}" alt="{{ product.title }}"
                    onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="no-photo-small" style="display: none; padding: 0; overflow: hidden;">
                    <svg class="category-placeholder" width="100%" height="100%" viewBox="0 0 150 150"
                        preserveAspectRatio="none"
                        data-category-id="{{ product.product_category.id if product.product_category else '' }}">
                        <rect width="100%" height="100%"
                            fill="{{ product.product_category.color|default('#ccc') if product.product_category else '#ccc' }}" />
                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-family="Arial" font-size="16"
                            fill="white" font-weight="500">
                            {{ product.product_category.name|truncate(15) if product.product_category else 'No Category'
                            }}
                        </text>
                    </svg>
                </div>
                {% else %}
                <div class="no-photo-small" style="padding: 0; overflow: hidden;">
                    <svg class="category-placeholder" width="100%" height="100%" viewBox="0 0 150 150"
                        preserveAspectRatio="none"
                        data-category-id="{{ product.product_category.id if product.product_category else '' }}">
                        <rect width="100%" height="100%"
                            fill="{{ product.product_category.color|default('#ccc') if product.product_category else '#ccc' }}" />
                        <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-family="Arial" font-size="16"
                            fill="white" font-weight="500">
                            {{ product.product_category.name|truncate(15) if product.product_category else 'No Category'
                            }}
                        </text>
                    </svg>
                </div>
                {% endif %}
            </div>
            <div class="list-product-info">
                <div class="list-product-title">{{ product.title }}</div>
                <div class="list-product-description">{{ product.description|truncate(150) if product.description else
                    'Нет описания' }}</div>
                <div class="list-product-meta">
                    <span class="list-category">{{ product.product_category.name if product.product_category else 'Без
                        категории' }}</span>
                    <span class="list-date">{{ product.created_at.strftime('%d.%m.%Y') }}</span>
                    <span class="list-status status-{{ product.status }}">{{ product.status_text }}</span>
                </div>
            </div>
            <div class="list-product-price">
                <span class="price-value">{{ product|format_product_price }}</span>
                {% if product.vat_included %}
                <span class="vat-label vat-included">С НДС</span>
                {% else %}
                <span class="vat-label vat-excluded">Без НДС</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>