{% extends "base.html" %}

{% block content %}
<div class="hero">
    <h1>–ü—Ä–æ–¥–∞–∂–∞ –Ω–µ–ª–∏–∫–≤–∏–¥–æ–≤ –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</h1>
    <p>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏</p>
    {% if not current_user.is_authenticated %}
        <a href="{{ url_for('auth.register') }}" class="btn">–ù–∞—á–∞—Ç—å –ø—Ä–æ–¥–∞–≤–∞—Ç—å</a>
    {% endif %}
</div>

<!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
<div class="search-filters">
    <div class="search-container">
        <form method="GET" action="{{ url_for('main.index') }}" class="search-form">
            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
            <div class="category-filter">
                <select name="category_id" onchange="this.form.submit()">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" 
                                {% if selected_category_id == category.id|string %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ -->
            <div class="search-box">
                <input type="text" 
                       name="search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º..." 
                       value="{{ search_query }}"
                       class="search-input">
                <button type="submit" class="search-btn">üîç</button>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ -->
            {% if search_query or selected_category_id %}
                <a href="{{ url_for('index') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
            {% endif %}
        </form>
    </div>
</div>

<div class="products-grid">
    <h2>
        {% if search_query or selected_category_id %}
            üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            {% if search_query %}"{{ search_query }}"{% endif %}
            {% if products|length > 0 %}({{ products|length }} –Ω–∞–π–¥–µ–Ω–æ){% endif %}
        {% else %}
            üî• –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        {% endif %}
    </h2>
    
    {% if products %}
        <div class="products-list">
            {% for product in products %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.images %}
                        <img src="{{ url_for('static', filename='uploads/' + product.images[0]) }}" 
                             alt="{{ product.title }}" 
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                    {% else %}
                        üì¶
                    {% endif %}
                </div>
                <div class="product-info">
                    <h3>{{ product.title }}</h3>
                    <p class="price">{{ "%.2f"|format(product.price) }} —Ä—É–±.</p>
                    {% if product.category %}
                        <p class="category">üìÇ {{ product.category.name }}</p>
                    {% endif %}
                    <p class="company">üè≠ {{ product.author.company_name }}</p>
                    <p class="description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                    <p class="date">üìÖ {{ product.created_at.strftime('%d.%m.%Y') }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-results">
            <p>üòî –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            {% if search_query or selected_category_id %}
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ <a href="{{ url_for('index') }}">—Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a></p>
            {% else %}
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}