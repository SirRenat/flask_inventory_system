{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <h2>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
    
    <div class="admin-tabs">
        <button class="tab-btn active" onclick="openTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
        <button class="tab-btn" onclick="openTab('categories')">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div id="users" class="tab-content active">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
        <div class="users-list">
            {% for user in users %}
            <div class="user-card {% if not user.is_active %}user-inactive{% endif %}">
                <div class="user-info">
                    <h4>{{ user.company_name }}</h4>
                    <p>üìß {{ user.email }}</p>
                    <p>üìû {{ user.phone or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
                    <p>üè¢ –ò–ù–ù: {{ user.inn or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
                    <p>üìÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ user.created_at.strftime('%d.%m.%Y') }}</p>
                    <p>üéØ –†–æ–ª—å: <span class="role-{{ user.role }}">{{ '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' if user.role == 'admin' else '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' }}</span></p>
                </div>
                <div class="user-actions">
                    <form method="POST" action="{{ url_for('admin_users') }}" class="inline-form">
                        <input type="hidden" name="user_id" value="{{ user.id }}">
                        <input type="hidden" name="action" value="toggle_active">
                        <button type="submit" class="btn {% if user.is_active %}btn-warning{% else %}btn-success{% endif %}">
                            {% if user.is_active %}üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å{% else %}‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å{% endif %}
                        </button>
                    </form>
                    {% if user.role != 'admin' %}
                    <form method="POST" action="{{ url_for('admin_users') }}" class="inline-form">
                        <input type="hidden" name="user_id" value="{{ user.id }}">
                        <input type="hidden" name="action" value="make_admin">
                        <button type="submit" class="btn btn-info">üëë –°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–æ–º</button>
                    </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div id="categories" class="tab-content">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div class="category-form">
            <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h4>
            <form method="POST" action="{{ url_for('admin_categories') }}">
                <input type="hidden" name="action" value="add">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select name="parent_id">
                        <option value="">-- –ë–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ --</option>
                        {% for cat in categories %}
                            <option value="{{ cat.id }}">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea name="description" rows="3"></textarea>
                </div>
                <button type="submit" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            </form>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="categories-tree">
            <h4>–î–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h4>
        {% for category in categories %}
        {% include '_category_item.html' %}
        {% endfor %}
</div>
    </div>
</div>

<script>
function openTab(tabName) {
    // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    var tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(function(tab) {
        tab.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById(tabName).classList.add('active');
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    var buttons = document.querySelectorAll('.tab-btn');
    buttons.forEach(function(btn) {
        btn.classList.remove('active');
    });
    event.currentTarget.classList.add('active');
}
</script>
{% endblock %}